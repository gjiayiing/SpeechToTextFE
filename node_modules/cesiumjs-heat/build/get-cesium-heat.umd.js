/*! For license information please see get-cesium-heat.umd.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.getCesiumHeat=e():t.getCesiumHeat=e()}(self,(()=>(()=>{var t={178:function(t,e,r){var n,i,a;a=function(){var t,e={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},r=function(){var t=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=0,this._max=1,this._xField=t.xField||t.defaultXField,this._yField=t.yField||t.defaultYField,this._valueField=t.valueField||t.defaultValueField,t.radius&&(this._cfgRadius=t.radius)},r=e.defaultRadius;return t.prototype={_organiseData:function(t,e){var n=t[this._xField],i=t[this._yField],a=this._radi,o=this._data,s=this._max,u=this._min,h=t[this._valueField]||1,c=t.radius||this._cfgRadius||r;return o[n]||(o[n]=[],a[n]=[]),o[n][i]?o[n][i]+=h:(o[n][i]=h,a[n][i]=c),o[n][i]>s?(e?this.setDataMax(o[n][i]):this._max=o[n][i],!1):{x:n,y:i,value:h,radius:c,min:u,max:s}},_unOrganizeData:function(){var t=[],e=this._data,r=this._radi;for(var n in e)for(var i in e[n])t.push({x:n,y:i,radius:r[n][i],value:e[n][i]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var t=arguments[0],e=t.length;e--;)this.addData.call(this,t[e]);else{var r=this._organiseData(arguments[0],!0);r&&this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[r]})}return this},setData:function(t){var e=t.data,r=e.length;this._data=[],this._radi=[];for(var n=0;n<r;n++)this._organiseData(e[n],!1);return this._max=t.max,this._min=t.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},t}(),n=function(){var t=function(t){var e=t.gradient||t.defaultGradient,r=document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;var i=n.createLinearGradient(0,0,256,1);for(var a in e)i.addColorStop(a,e[a]);return n.fillStyle=i,n.fillRect(0,0,256,1),n.getImageData(0,0,256,1).data},e=function(t,e){var r=document.createElement("canvas"),n=r.getContext("2d"),i=t,a=t;if(r.width=r.height=2*t,1==e)n.beginPath(),n.arc(i,a,t,0,2*Math.PI,!1),n.fillStyle="rgba(0,0,0,1)",n.fill();else{var o=n.createRadialGradient(i,a,t*e,i,a,t);o.addColorStop(0,"rgba(0,0,0,1)"),o.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=o,n.fillRect(0,0,2*t,2*t)}return r};function r(e){var r=e.container,n=this.shadowCanvas=document.createElement("canvas"),i=this.canvas=e.canvas||document.createElement("canvas"),a=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(e.container)||{});i.className="heatmap-canvas",this._width=i.width=n.width=e.width||+a.width.replace(/px/,""),this._height=i.height=n.height=e.height||+a.height.replace(/px/,""),this.shadowCtx=n.getContext("2d"),this.ctx=i.getContext("2d"),i.style.cssText=n.style.cssText="position:absolute;left:0;top:0;",r.style.position="relative",r.appendChild(i),this._palette=t(e),this._templates={},this._setStyles(e)}return r.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(function(t){for(var e=[],r=t.min,n=t.max,i=t.radi,a=(t=t.data,Object.keys(t)),o=a.length;o--;)for(var s=a[o],u=Object.keys(t[s]),h=u.length;h--;){var c=u[h],l=t[s][c],f=i[s][c];e.push({x:s,y:c,value:l,radius:f})}return{min:r,max:n,data:e}}(t)),this._colorize())},_updateGradient:function(e){this._palette=t(e)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,e){this._width=t,this._height=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity),this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(t){for(var r=this._min=t.min,n=this._max=t.max,i=(t=t.data||[]).length,a=1-this._blur;i--;){var o,s=t[i],u=s.x,h=s.y,c=s.radius,l=Math.min(s.value,n),f=u-c,d=h-c,p=this.shadowCtx;this._templates[c]?o=this._templates[c]:this._templates[c]=o=e(c,a);var v=(l-r)/(n-r);p.globalAlpha=v<.01?.01:v,p.drawImage(o,f,d),f<this._renderBoundaries[0]&&(this._renderBoundaries[0]=f),d<this._renderBoundaries[1]&&(this._renderBoundaries[1]=d),f+2*c>this._renderBoundaries[2]&&(this._renderBoundaries[2]=f+2*c),d+2*c>this._renderBoundaries[3]&&(this._renderBoundaries[3]=d+2*c)}},_colorize:function(){var t=this._renderBoundaries[0],e=this._renderBoundaries[1],r=this._renderBoundaries[2]-t,n=this._renderBoundaries[3]-e,i=this._width,a=this._height,o=this._opacity,s=this._maxOpacity,u=this._minOpacity,h=this._useGradientOpacity;t<0&&(t=0),e<0&&(e=0),t+r>i&&(r=i-t),e+n>a&&(n=a-e);for(var c=this.shadowCtx.getImageData(t,e,r,n),l=c.data,f=l.length,d=this._palette,p=3;p<f;p+=4){var v,m=l[p],y=4*m;y&&(v=o>0?o:m<s?m<u?u:m:s,l[p-3]=d[y],l[p-2]=d[y+1],l[p-1]=d[y+2],l[p]=h?d[y+3]:v)}this.ctx.putImageData(c,t,e),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var e=this.shadowCtx.getImageData(t.x,t.y,1,1).data[3],r=this._max,n=this._min;return Math.abs(r-n)*(e/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},r}(),i=(t=!1,"canvas2d"===e.defaultRenderer&&(t=n),t),a=function(){for(var t={},e=arguments.length,r=0;r<e;r++){var n=arguments[r];for(var i in n)t[i]=n[i]}return t},o=function(){var t=function(){function t(){this.cStore={}}return t.prototype={on:function(t,e,r){var n=this.cStore;n[t]||(n[t]=[]),n[t].push((function(t){return e.call(r,t)}))},emit:function(t,e){var r=this.cStore;if(r[t])for(var n=r[t].length,i=0;i<n;i++)(0,r[t][i])(e)}},t}();function n(){var n,o,s,u,h=this._config=a(e,arguments[0]||{});if(this._coordinator=new t,h.plugin){var c=h.plugin;if(!e.plugins[c])throw new Error("Plugin '"+c+"' not found. Maybe it was not registered.");var l=e.plugins[c];this._renderer=new l.renderer(h),this._store=new l.store(h)}else this._renderer=new i(h),this._store=new r(h);o=(n=this)._renderer,s=n._coordinator,u=n._store,s.on("renderpartial",o.renderPartial,o),s.on("renderall",o.renderAll,o),s.on("extremachange",(function(t){n._config.onExtremaChange&&n._config.onExtremaChange({min:t.min,max:t.max,gradient:n._config.gradient||n._config.defaultGradient})})),u.setCoordinator(s)}return n.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=a(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},n}();return{create:function(t){return new o(t)},register:function(t,r){e.plugins[t]=r}}},t.exports?t.exports=a():void 0===(i="function"==typeof(n=a)?n.call(e,r,e,t):n)||(t.exports=i)},96:(t,e,r)=>{var n="Expected a function",i=NaN,a="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,h=/^0o[0-7]+$/i,c=parseInt,l="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,f="object"==typeof self&&self&&self.Object===Object&&self,d=l||f||Function("return this")(),p=Object.prototype.toString,v=Math.max,m=Math.min,y=function(){return d.Date.now()};function g(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function _(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&p.call(t)==a}(t))return i;if(g(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=g(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var r=u.test(t);return r||h.test(t)?c(t.slice(2),r?2:8):s.test(t)?i:+t}t.exports=function(t,e,r){var i=!0,a=!0;if("function"!=typeof t)throw new TypeError(n);return g(r)&&(i="leading"in r?!!r.leading:i,a="trailing"in r?!!r.trailing:a),function(t,e,r){var i,a,o,s,u,h,c=0,l=!1,f=!1,d=!0;if("function"!=typeof t)throw new TypeError(n);function p(e){var r=i,n=a;return i=a=void 0,c=e,s=t.apply(n,r)}function x(t){var r=t-h;return void 0===h||r>=e||r<0||f&&t-c>=o}function w(){var t=y();if(x(t))return b(t);u=setTimeout(w,function(t){var r=e-(t-h);return f?m(r,o-(t-c)):r}(t))}function b(t){return u=void 0,d&&i?p(t):(i=a=void 0,s)}function O(){var t=y(),r=x(t);if(i=arguments,a=this,h=t,r){if(void 0===u)return function(t){return c=t,u=setTimeout(w,e),l?p(t):s}(h);if(f)return u=setTimeout(w,e),p(h)}return void 0===u&&(u=setTimeout(w,e)),s}return e=_(e)||0,g(r)&&(l=!!r.leading,o=(f="maxWait"in r)?v(_(r.maxWait)||0,e):o,d="trailing"in r?!!r.trailing:d),O.cancel=function(){void 0!==u&&clearTimeout(u),c=0,i=h=a=u=void 0},O.flush=function(){return void 0===u?s:b(y())},O}(t,e,{leading:i,maxWait:e,trailing:a})}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{default:()=>v});var t=r(178),e=r(96),i=r.n(e);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function o(){o=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",h=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var a=e&&e.prototype instanceof _?e:_,o=Object.create(a.prototype),s=new A(n||[]);return i(o,"_invoke",{value:S(t,r,s)}),o}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function _(){}function x(){}function w(){}var b={};l(b,u,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(R([])));j&&j!==r&&n.call(j,u)&&(b=j);var D=w.prototype=_.prototype=Object.create(b);function C(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,o,s,u){var h=d(t[i],t,o);if("throw"!==h.type){var c=h.arg,l=c.value;return l&&"object"==a(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,s,u)}),(function(t){r("throw",t,s,u)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,u)}))}u(h.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function S(e,r,n){var i=p;return function(a,o){if(i===m)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:t,done:!0}}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var u=M(s,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=m;var h=d(e,r,n);if("normal"===h.type){if(i=n.done?y:v,h.arg===g)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(i=y,n.method="throw",n.arg=h.arg)}}}function M(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,M(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=d(i,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(a(e)+" is not iterable")}return x.prototype=w,i(D,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:x,configurable:!0}),x.displayName=l(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,l(t,c,"GeneratorFunction")),t.prototype=Object.create(D),t},e.awrap=function(t){return{__await:t}},C(E.prototype),l(E.prototype,h,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new E(f(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(D),l(D,c,"Generator"),l(D,u,(function(){return this})),l(D,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),h=n.call(o,"finallyLoc");if(u&&h){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){var n,i,a;n=t,i=e,a=r[e],(i=p(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a,o,s=[],u=!0,h=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==e);u=!0);}catch(t){h=!0,i=t}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(h)throw i}}return s}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,p(n.key),n)}}function p(t){var e=function(t,e){if("object"!==a(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===a(e)?e:String(e)}const v=function(e){return function(){function r(e){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{autoMaxMin:!0,data:[]},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-180,-90,180,90],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{enabled:!0,throttle:200,min:6375e3,max:1e7,maxRadius:40,minRadius:10},l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{totalArea:1036800,autoResize:!0};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),"undefined"!=typeof window){this.updateCesium=i()(this._updateCesium,u.throttle||200,{trailing:!0}),this.viewer=e,this.bbox=o,this.autoRadiusConfig=u,this.max=void 0,this.min=void 0;var f=c(o,4),d=f[0],p=f[1],v=f[2],y=f[3],g=y-p,_=v-d;if(this.boxMeta={top:y,left:d,height:g,width:_},l.autoResize){if(!l.totalArea)throw"specify totalArea if auto resize";var x=Math.floor(Math.sqrt(g*l.totalArea)),w=Math.floor(x*_/g);this.canvasConfig=h(h({},l),{},{width:w,height:x})}else{if(!l.width||!l.height)throw"specify width and height if not auto resize";this.canvasConfig=l}var b,O=h({},s);if(O.container||(this.mountPoint=m({position:"absolute",top:0,left:0,"z-index":-100,overflow:"hidden",width:0,height:0},document.body),O.container=m({width:this.canvasConfig.width,height:this.canvasConfig.height},this.mountPoint)),this.heatmapConfig=O,this.heatmap=t.create(O),!(b=Array.isArray(a)?{autoMaxMin:!0,data:a}:h({},a)).autoMaxMin){if(!b.min||!b.max)throw"need max and min when not auto";this.min=b.min,this.max=b.max}var j=b.data.map((function(t){return n.updateMaxMin(t.value),n.convertData(t)}));delete b.data,this.dataConfig=b,this.data=j;var D={max:this.max,min:this.min,data:j};this.heatmap.setData(D),this.updateCesium(u.enabled),this.cameraMoveEnd=function(){return n.updateCesium(!0)},this.postRender=function(){n.postRenderSkip?n.postRenderSkip=!1:(n.postRenderSkip=!0,n.updateCesium(!0))},u.enabled&&this.viewer.camera.moveEnd.addEventListener(this.cameraMoveEnd)}}var n,a,u,p;return n=r,a=[{key:"addData",value:function(t){var e=this;Array.isArray(t)?this.data=this.data.concat(t.map((function(t){return e.updateMaxMin(t.value),e.convertData(t)}))):(this.updateMaxMin(t.value),this.data.push(this.convertData(t))),this.updateCesium(!0)}},{key:"updateHeatmap",value:function(){var t=this.viewer.camera.getMagnitude(),e=this.autoRadiusConfig,r=e.min,n=e.max,i=e.minRadius,a=e.maxRadius,o=parseInt(i+(a-i)*(t-r)/(n-r));this.heatmap.setData({max:this.max,min:this.min,data:this.data.map((function(t){return{x:t.x,y:t.y,value:t.value,radius:o}}))})}},{key:"_updateCesium",value:(u=o().mark((function t(r){var n,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer&&this.viewer.scene.imageryLayers.remove(this.layer),r&&this.updateHeatmap(),t.next=4,e.SingleTileImageryProvider.fromUrl(this.heatmap.getDataURL(),{rectangle:(n=e.Rectangle).fromDegrees.apply(n,(a=this.bbox,function(t){if(Array.isArray(t))return f(t)}(a)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(a)||l(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))});case 4:i=t.sent,this.layer=this.viewer.scene.imageryLayers.addImageryProvider(i);case 6:case"end":return t.stop()}var a}),t,this)})),p=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=u.apply(t,e);function a(t){s(i,r,n,a,o,"next",t)}function o(t){s(i,r,n,a,o,"throw",t)}a(void 0)}))},function(t){return p.apply(this,arguments)})},{key:"convertData",value:function(t){var e=t.x,r=t.y,n=t.value,i=c(this.gps2point([e,r]),2);return{x:i[0],y:i[1],value:n}}},{key:"updateMaxMin",value:function(t){void 0===this.max?this.max=t:this.max=Math.max(t,this.max),void 0===this.min?this.min=t:this.min=Math.min(t,this.min)}},{key:"gps2point",value:function(){var t=c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],2),e=t[0],r=t[1],n=this.boxMeta,i=n.top,a=n.left,o=n.height,s=n.width,u=this.canvasConfig;return[parseInt((e-a)/s*u.width),parseInt((i-r)/o*u.height)]}},{key:"destory",value:function(){this.autoRadiusConfig.enabled&&this.viewer.camera.moveEnd.removeEventListener(this.cameraMoveEnd),this.layer&&this.viewer.scene.imageryLayers.remove(this.layer),this.mountPoint&&this.mountPoint.remove()}}],a&&d(n.prototype,a),Object.defineProperty(n,"prototype",{writable:!1}),r}()};function m(t,e){var r=document.createElement("div");for(var n in e&&e.append(r),t)"number"!=typeof t[n]?r.style[n]=t[n]:r.style[n]=t[n]+"px";return r}})(),n})()));